var SVIFT={};SVIFT.helper={},SVIFT.helper.debouncer=function(t,n){var e,a=n||200;return function(){var n=this,i=arguments;clearTimeout(e),e=setTimeout(function(){t.apply(n,Array.prototype.slice.call(i))},a)}},SVIFT.helper.interpolate=function(t){var n,e={};for(e.def=t,e.interpolate=[],e.duration=0,n=1;e.def.length>n;n++)"ease"in e.def[n]||(e.def[n].ease=!1),e.interpolate.push(d3.interpolate(e.def[n-1].value,e.def[n].value)),e.duration+=e.def[n].duration;var a=0;for(n=1;e.def.length>n;n++)e.def[n].duration=e.def[n].duration/e.duration,e.def[n].start=a,a+=e.def[n].duration;return e.i=function(t){for(var n=1;e.def.length>n;n++)if(t>=e.def[n].start&&e.def[n].start+e.def[n].duration>=t)return e.def[n].ease?e.interpolate[n-1](e.def[n].ease((t-e.def[n].start)/e.def[n].duration)):e.interpolate[n-1]((t-e.def[n].start)/e.def[n].duration)},e.i},SVIFT.helper.switchCol=function(t,n,e){return t.forEach(function(t){var a=t[n];t[n]=t[e],t[e]=a}),t},SVIFT.helper.transpose=function(t){var n={};return t.forEach(function(t){for(var e in t)e in n||(n[e]=[])}),t.forEach(function(t){for(var e in n)e in t?n[e].push(t[e]):n[e].push(null)}),n},SVIFT.helper.cleanAxis=function(t){var n;n=t.attr("text-anchor")?t:t.select('g[text-anchor="*"]');var e=n.attr("text-anchor");n.selectAll("text").attr("text-anchor",e);var a=n.attr("font-size");n.selectAll("text").each(function(){var t=d3.select(this);["y","x"].forEach(function(n){var e=t.attr("d"+n);if(e){e.indexOf("em")>=0&&(e=parseFloat(e.substr(0,e.length-2))*a),t.attr("d"+n,0);var i=t.attr(n);i&&(e+=parseFloat(i)),t.attr(n,e)}})})},SVIFT.vis={},SVIFT.vis.base=function(t,n){var e={};return e.data=t,e.container=n,e.g=null,e.svg=null,e.config={maxWidth:4096,maxHeight:4096,margin:{top:20,right:20,bottom:20,left:20},font:{sizes:{1500:25,1000:20,0:16},"default":"14px"},paddingTopText:20,paddingBottomText:20},e.timeline={},e.init=function(){var n,a=e.container.node().offsetWidth;for(var i in e.config.font.sizes)a>=i&&(n=e.config.font.sizes[i]);e.svg=e.container.append("svg").attr("width","100%").attr("height","100%").attr("font-size",n).style("background-color","#ffffff"),e.defs=e.svg.append("defs"),e.g=e.svg.append("g").attr("transform","translate("+e.config.margin.top+","+e.config.margin.left+")"),e.config.topTextWrapper=e.g.append("g").attr("text-anchor","middle").attr("class","title-wrapper").attr("font-family",t.style.font),e.config.titleMain=e.config.topTextWrapper.append("text").text(t.data.title).attr("font-size","1.7em").attr("fill",t.style.color.main),e.config.titleSub=e.config.topTextWrapper.append("text").text(t.data.subTitle).attr("font-size","1em").attr("fill",t.style.color.second),e.config.bottomTextWrapper=e.g.append("g").attr("font-family","InterfaceRegular"),e.config.attribution=e.config.bottomTextWrapper.append("text").text(t.data.attribution).attr("font-size",e.config.font.default).attr("fill",t.style.color.second),e.config.source=e.config.bottomTextWrapper.append("text").text(t.data.source).attr("font-size",e.config.font.default).attr("fill",t.style.color.second),e.config.vizContainer=e.g.append("g").attr("class","viz-container"),e.playHead=0,e.setup(),e.resizeText(),e.resize();for(var i in e.timeline){var o=e.timeline[i];o.end>e.playTime&&(e.playTime=o.end)}e.time.step=e.playTime/(e.playTime/1e3*e.time.fps),"function"==typeof window.callPhantom&&window.callPhantom({msg:"setupDone"}),d3.select(window).on("resize",SVIFT.helper.debouncer(function(){e.resizeText(),e.resize()},200))},e.process=function(){},e.setup=function(){},e.update=function(){},e.resize=function(){},e.resizeText=function(){var t=e.container.node().offsetWidth-e.config.margin.left-e.config.margin.right,n=t/2;e.config.titleMain.attr("x",n).attr("y",function(){return e.config.titleMainHeight=this.getBBox().height,e.config.titleMainHeight}),e.config.titleSub.attr("x",n).attr("y",function(){return e.config.titleMainHeight+this.getBBox().height+10}),e.config.bottomTextWrapper.attr("transform","translate(0,"+(e.container.node().offsetHeight-e.config.margin.top-e.config.margin.bottom)+")"),e.config.attribution.attr("x",function(){return t-this.getBBox().width}),e.config.source.attr("x",0),e.config.topTextHeight=e.config.topTextWrapper.node().getBBox().height+e.config.paddingTopText,e.config.bottomTextHeight=e.config.bottomTextWrapper.node().getBBox().height+e.config.paddingBottomText,e.config.vizContainer.attr("transform","translate(0,"+e.config.topTextHeight+")")},e.draw=function(t){for(var n in e.timeline){var a=e.timeline[n];t>=a.start&&a.end>=t?a.func((t-a.start)/(a.end-a.start)):t>a.end&&a.func(1)}},e.playHead=0,e.playState=!1,e.playTime=0,e.time={fps:30,step:0,elapsed:0,fpsInterval:1e3/30,then:0,startTime:0,now:0},e.play=function(){e.playState&&("function"==typeof window.callPhantom?(e.playHead+=e.time.step,e.playTime>=e.playHead?(e.draw(e.playHead),window.callPhantom({msg:"drawDone",playHead:e.playHead})):(e.playHead=e.playTime,e.draw(e.playHead),e.pause(),window.callPhantom({msg:"playDone"}))):(0===e.time.then&&(e.time.then=e.time.startTime=Date.now()),e.time.now=Date.now(),e.time.elapsed=e.time.now-e.time.then,e.playTime>=e.time.now-e.time.startTime?(window.requestAnimationFrame(e.play),e.time.elapsed>e.time.fpsInterval&&(e.time.then=e.time.now-e.time.elapsed%e.time.fpsInterval,e.playHead=e.time.now-e.time.startTime,e.draw(e.playHead))):(e.playHead=e.playTime,e.goTo(1),e.pause())))},e.start=function(){e.playState=!0,e.play()},e.pause=function(){e.playState=!1},e.goTo=function(t){e.playTime>=t&&(e.playHead=t*e.playTime,e.draw(e.playHead)),e.pause()},e},SVIFT.vis.barchart=function(t,n){var e=SVIFT.vis.base(t,n);return e.d3config={axisWidth:50,axisHeight:50,ease:d3.easeCubicInOut,wInterpolate:[]},e.setup=function(){t.data.data.forEach(function(t,n){var a=e.defs.append("linearGradient").attr("id","grad"+n).attr("x1","0%").attr("y1","0%").attr("y2","0%").attr("x2","100%").attr("spreadMethod","pad");a.append("stop").attr("offset","0%").attr("stop-color","rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")").attr("stop-opacity","1"),a.append("stop").attr("offset","100%").attr("stop-color","rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")").attr("stop-opacity","1")}),e.d3config.y=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t){return t[0]})),e.d3config.yAxis=d3.axisLeft(),e.d3config.x=d3.scaleLinear().domain([0,d3.max(t.data.data,function(t){return t[1]})]),e.d3config.xAxis=d3.axisBottom(),e.d3config.gXAxis=e.g.append("g"),e.d3config.gYAxis=e.g.append("g").attr("transform","translate("+(e.d3config.axisWidth-1)+",0)"),e.d3config.bars=e.g.append("g").selectAll("rect").data(t.data.data).enter().append("rect").attr("x",e.d3config.axisWidth).style("stroke","transparent").style("fill",function(t,n){return'url("#grad'+n+'")'})},e.resize=function(){var n=e.container.node().offsetWidth-e.config.margin.left-e.config.margin.right-e.d3config.axisWidth,a=e.container.node().offsetHeight-e.config.margin.top-e.config.margin.bottom-e.d3config.axisHeight;e.d3config.x.range([0,n]),e.d3config.y.range([0,a]),e.d3config.xAxis.scale(e.d3config.x),e.d3config.gXAxis.call(e.d3config.xAxis),e.d3config.yAxis.scale(e.d3config.y),e.d3config.gYAxis.call(e.d3config.yAxis),e.d3config.gXAxis.attr("transform","translate("+e.d3config.axisWidth+","+a+")"),e.d3config.bars.attr("y",function(t){return e.d3config.y(t[0])}).attr("height",e.d3config.y.bandwidth()),t.data.data.forEach(function(t,n){e.d3config.wInterpolate[n]=d3.interpolate(0,e.d3config.x(t[1]))}),e.drawBars(e.playHead/e.playTime)},e.drawBars=function(t){e.d3config.bars.attr("width",function(n,a){return e.d3config.wInterpolate[a](e.d3config.ease(t))})},e.timeline={bars:{start:0,end:3e3,func:e.drawBars}},e},SVIFT.vis.columns=function(t,n){var e=SVIFT.vis.base(t,n);e.d3config={ease:d3.easeQuadOut,yInterpolate:[],hInterpolate:[],oInterpolate:[],steps:t.data.data.length,animation:{duration:3e3,barPartPercent:.8}},e.setup=function(){e.d3config.x=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t){return t[0]})),e.d3config.y=d3.scaleLinear().domain([0,d3.max(t.data.data,function(t){return t[1]})]),e.d3config.barsContainer=e.config.vizContainer.append("g").selectAll("g").data(t.data.data).enter().append("g"),e.d3config.bars=e.d3config.barsContainer.append("rect").style("stroke","transparent").style("fill",t.style.color.main),e.d3config.barsText=e.d3config.barsContainer.append("text").text(function(t){return t[0]}).attr("font-family",t.style.font).attr("fill",t.style.color.second).attr("text-anchor","middle"),e.d3config.barsNumber=e.d3config.barsContainer.append("text").text(function(t){return t[1]}).attr("font-family",t.style.font).attr("fill",t.style.color.second).attr("text-anchor","middle");for(var n=e.d3config.animation.duration*e.d3config.animation.barPartPercent,a=n/e.d3config.steps,i=0;e.d3config.steps>i;i++){var o=a*i-a/2;0==i&&(o=0);var r=a*(i+1);e.timeline["animationBar"+i]={start:o,end:r,func:e["drawBar"+i]}}for(var f=e.d3config.animation.duration-n,d=f/e.d3config.steps,i=0;e.d3config.steps>i;i++){var o=d*i-d/2+n;0==i&&(o=n);var r=d*(i+1)+n;e.timeline["animationBarText"+i]={start:o,end:r,func:e["drawBarLable"+i]}}},e.resize=function(){var n=e.d3config.barsNumber._groups[0][0].getBBox().height,a=e.d3config.barsText._groups[0][0].getBBox().height,i=15,o=n+i;e.d3config.barsContainer.attr("transform","translate(0,"+o+")");var r=e.container.node().offsetWidth-e.config.margin.left-e.config.margin.right,f=e.container.node().offsetHeight-e.config.margin.top-e.config.margin.bottom-e.config.bottomTextHeight-e.config.topTextHeight-n-a-o;e.d3config.x.range([0,r]),e.d3config.y.range([f,0]),e.d3config.bars.attr("x",function(t){return e.d3config.x(t[0])}).attr("width",e.d3config.x.bandwidth()).attr("opacity",0),e.d3config.barsText.attr("x",function(t){return e.d3config.x(t[0])+e.d3config.x.bandwidth()/2}).attr("y",function(){return this.getBBox().height+f+i}).attr("font-size","1.5em").attr("opacity",0),e.d3config.barsNumber.attr("x",function(t){return e.d3config.x(t[0])+e.d3config.x.bandwidth()/2}).attr("y",function(t){return e.d3config.y(t[1])-i}).attr("font-size","1.5em").attr("opacity",0),t.data.data.forEach(function(t,n){e.d3config.yInterpolate[n]=d3.interpolate(f,e.d3config.y(t[1])),e.d3config.hInterpolate[n]=d3.interpolate(0,f-e.d3config.y(t[1])),e.d3config.oInterpolate[n]=d3.interpolate(0,1)})};for(var a=function(t){return function(n){d3.select(e.d3config.bars._groups[0][t]).attr("y",function(){return e.d3config.yInterpolate[t](e.d3config.ease(n))}).attr("height",function(){return e.d3config.hInterpolate[t](e.d3config.ease(n))}).attr("opacity",function(){return e.d3config.oInterpolate[t](e.d3config.ease(n))})}},i=0;e.d3config.steps>i;i++)e["drawBar"+i]=a(i);for(var o=function(t){return function(n){d3.select(e.d3config.barsText._groups[0][t]).attr("opacity",function(){return e.d3config.oInterpolate[t](e.d3config.ease(n))}),d3.select(e.d3config.barsNumber._groups[0][t]).attr("opacity",function(){return e.d3config.oInterpolate[t](e.d3config.ease(n))})}},i=0;e.d3config.steps>i;i++)e["drawBarLable"+i]=o(i);return e},SVIFT.vis.count=function(t,n){var e=SVIFT.vis.base(t,n);return e.d3config={ease:d3.easeCubicInOut,interpolate:d3.interpolate(0,t.data.data[0])},e.setup=function(){e.d3config.count=e.g.append("text").text(t.data.data[0]).attr("fill",t.style.color.main).attr("text-anchor","middle").attr("font-size",100).attr("opacity",0).attr("font-family",t.style.font)},e.resize=function(){var t=e.container.node().offsetWidth-e.config.margin.left-e.config.margin.right,n=e.container.node().offsetHeight-e.config.margin.top-e.config.margin.bottom,a=n-e.config.topTextHeight-e.config.bottomTextHeight,i=Math.min(a,t);e.d3config.count.attr("x",t/2).attr("font-size",function(){var t=this.getBBox(),n=1.1*Math.min(t.width,t.height),a=d3.select(this).attr("font-size");return e.d3config.fatNumberNewSize=a*(i/n),e.d3config.fatNumberNewSize}).attr("opacity",1).attr("y",function(){return e.d3config.fatNumberNewSize+e.config.topTextHeight})},e.animateNumber=function(t){var n=Math.round(e.d3config.interpolate(e.d3config.ease(t)));e.d3config.count.text(n)},e.timeline={bars:{start:0,end:3e3,func:e.animateNumber}},e},SVIFT.vis.mosaic=function(t,n){var e=SVIFT.vis.base(t,n);return e.d3config={ease:d3.easeCubicInOut,interpolate:d3.interpolate(0,t.data.data[0])},e.gridSetupData=function(t){var n=.1*t;t-=n;for(var e=Array(),a=1,i=1,o=0;10>o;o++){e.push(Array());for(var r=0;10>r;r++)e[o].push({x:a,y:i,width:t,height:t}),a+=t+n;a=1,i+=t+n}return e},e.setup=function(){var n=e.gridSetupData(10);e.d3config.rowContainer=e.g.append("g").attr("id","rowContainer"),e.d3config.row=e.d3config.rowContainer.selectAll(".row").data(n).enter().append("g").attr("class","row"),e.d3config.column=e.d3config.row.selectAll(".square").data(function(t){return t}).enter().append("rect").attr("class","square").style("fill",t.style.color.second).style("stroke","#fff"),e.d3config.mosaicValueText=e.g.append("text").text(t.data.data[0]+"%").attr("font-family",t.style.font).attr("fill",t.style.color.main).attr("text-anchor","middle")},e.resize=function(){var t=e.container.node().offsetWidth-e.config.margin.left-e.config.margin.right,n=e.container.node().offsetHeight-e.config.margin.top-e.config.margin.bottom;e.d3config.mosaicValueText.attr("x",t/2).attr("font-size","2.5em");var a=e.config.bottomTextHeight+e.config.topTextHeight+e.d3config.mosaicValueText.node().getBBox().height+20,i=Math.min(t,n-a),o=i/10,r=e.gridSetupData(o);e.d3config.row.data(r).enter(),e.d3config.column.data(function(t){return t}).enter(),e.d3config.column.attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}),e.d3config.rowContainer.attr("transform","translate("+(t-i)/2+","+e.config.topTextHeight+")");var f=e.d3config.rowContainer.node().getBBox().height;e.d3config.mosaicValueText.attr("y",f+e.config.topTextHeight+e.config.margin.left+e.config.margin.right+20)},e.drawBars=function(n){var a=Math.round(e.d3config.interpolate(e.d3config.ease(n)));d3.selectAll("rect").filter(function(t,n){return a-1>=n}).style("fill",t.style.color.main),e.d3config.mosaicValueText.text(a+"%")},e.timeline={bars:{start:0,end:3e3,func:e.drawBars}},e};