var SVIFT={};SVIFT.helper={},SVIFT.helper.debouncer=function(t,e){var a,n=e||200;return function(){var e=this,i=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(e,Array.prototype.slice.call(i))},n)}},SVIFT.helper.interpolate=function(t){var e,a={};for(a.def=t,a.interpolate=[],a.duration=0,e=1;a.def.length>e;e++)"ease"in a.def[e]||(a.def[e].ease=!1),a.interpolate.push(d3.interpolate(a.def[e-1].value,a.def[e].value)),a.duration+=a.def[e].duration;var n=0;for(e=1;a.def.length>e;e++)a.def[e].duration=a.def[e].duration/a.duration,a.def[e].start=n,n+=a.def[e].duration;return a.i=function(t){for(var e=1;a.def.length>e;e++)if(t>=a.def[e].start&&a.def[e].start+a.def[e].duration>=t)return a.def[e].ease?a.interpolate[e-1](a.def[e].ease((t-a.def[e].start)/a.def[e].duration)):a.interpolate[e-1]((t-a.def[e].start)/a.def[e].duration)},a.i},SVIFT.helper.switchCol=function(t,e,a){return t.forEach(function(t){var n=t[e];t[e]=t[a],t[a]=n}),t},SVIFT.helper.transpose=function(t){var e={};return t.forEach(function(t){for(var a in t)a in e||(e[a]=[])}),t.forEach(function(t){for(var a in e)a in t?e[a].push(t[a]):e[a].push(null)}),e},SVIFT.helper.cleanAxis=function(t){var e;e=t.attr("text-anchor")?t:t.select('g[text-anchor="*"]');var a=e.attr("text-anchor");e.selectAll("text").attr("text-anchor",a);var n=e.attr("font-size");e.selectAll("text").each(function(){var t=d3.select(this);["y","x"].forEach(function(e){var a=t.attr("d"+e);if(a){a.indexOf("em")>=0&&(a=parseFloat(a.substr(0,a.length-2))*n),t.attr("d"+e,0);var i=t.attr(e);i&&(a+=parseFloat(i)),t.attr(e,a)}})})},SVIFT.vis={},SVIFT.vis.base=function(t,e){var a={};return a.data=t,a.container=e,a.g=null,a.svg=null,a.config={maxWidth:4096,maxHeight:4096,margin:{top:20,right:20,bottom:20,left:20}},a.timeline={},a.init=function(){a.svg=a.container.append("svg").attr("width","100%").attr("height","100%").style("background-color","#ffffff"),a.defs=a.svg.append("defs"),a.g=a.svg.append("g").attr("transform","translate("+a.config.margin.top+","+a.config.margin.left+")"),a.playHead=0,a.setup(),a.resize();for(var t in a.timeline){var e=a.timeline[t];e.end>a.playTime&&(a.playTime=e.end)}a.time.step=a.playTime/(a.playTime/1e3*a.time.fps),"function"==typeof window.callPhantom&&window.callPhantom({msg:"setupDone"}),d3.select(window).on("resize",SVIFT.helper.debouncer(function(){a.resize()},200))},a.process=function(){},a.setup=function(){},a.update=function(){},a.resize=function(){},a.draw=function(t){for(var e in a.timeline){var n=a.timeline[e];t>=n.start&&n.end>=t?n.func((t-n.start)/(n.end-n.start)):t>n.end&&n.func(1)}},a.playHead=0,a.playState=!1,a.playTime=0,a.time={fps:30,step:0,elapsed:0,fpsInterval:1e3/30,then:0,startTime:0,now:0},a.play=function(){a.playState&&("function"==typeof window.callPhantom?(a.playHead+=a.time.step,a.playTime>=a.playHead?(a.draw(a.playHead),window.callPhantom({msg:"drawDone",playHead:a.playHead})):(a.playHead=a.playTime,a.draw(a.playHead),a.pause(),window.callPhantom({msg:"playDone"}))):(0===a.time.then&&(a.time.then=a.time.startTime=Date.now()),a.time.now=Date.now(),a.time.elapsed=a.time.now-a.time.then,a.playTime>=a.time.now-a.time.startTime?(window.requestAnimationFrame(a.play),a.time.elapsed>a.time.fpsInterval&&(a.time.then=a.time.now-a.time.elapsed%a.time.fpsInterval,a.playHead=a.time.now-a.time.startTime,a.draw(a.playHead))):(a.playHead=a.playTime,a.goTo(1),a.pause())))},a.start=function(){a.playState=!0,a.play()},a.pause=function(){a.playState=!1},a.goTo=function(t){a.playTime>=t&&(a.playHead=t*a.playTime,a.draw(a.playHead)),a.pause()},a},SVIFT.vis.barchart=function(t,e){var a=SVIFT.vis.base(t,e);return a.d3config={axisWidth:50,axisHeight:50,ease:d3.easeCubicInOut,wInterpolate:[]},a.setup=function(){t.data.data.forEach(function(t,e){var n=a.defs.append("linearGradient").attr("id","grad"+e).attr("x1","0%").attr("y1","0%").attr("y2","0%").attr("x2","100%").attr("spreadMethod","pad");n.append("stop").attr("offset","0%").attr("stop-color","rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")").attr("stop-opacity","1"),n.append("stop").attr("offset","100%").attr("stop-color","rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")").attr("stop-opacity","1")}),a.d3config.y=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t){return t[0]})),a.d3config.yAxis=d3.axisLeft(),a.d3config.x=d3.scaleLinear().domain([0,d3.max(t.data.data,function(t){return t[1]})]),a.d3config.xAxis=d3.axisBottom(),a.d3config.gXAxis=a.g.append("g"),a.d3config.gYAxis=a.g.append("g").attr("transform","translate("+(a.d3config.axisWidth-1)+",0)"),a.d3config.bars=a.g.append("g").selectAll("rect").data(t.data.data).enter().append("rect").attr("x",a.d3config.axisWidth).style("stroke","transparent").style("fill",function(t,e){return'url("#grad'+e+'")'})},a.resize=function(){var e=a.container.node().offsetWidth-a.config.margin.left-a.config.margin.right-a.d3config.axisWidth,n=a.container.node().offsetHeight-a.config.margin.top-a.config.margin.bottom-a.d3config.axisHeight;a.d3config.x.range([0,e]),a.d3config.y.range([0,n]),a.d3config.xAxis.scale(a.d3config.x),a.d3config.gXAxis.call(a.d3config.xAxis),a.d3config.yAxis.scale(a.d3config.y),a.d3config.gYAxis.call(a.d3config.yAxis),a.d3config.gXAxis.attr("transform","translate("+a.d3config.axisWidth+","+n+")"),a.d3config.bars.attr("y",function(t){return a.d3config.y(t[0])}).attr("height",a.d3config.y.bandwidth()),t.data.data.forEach(function(t,e){a.d3config.wInterpolate[e]=d3.interpolate(0,a.d3config.x(t[1]))}),a.drawBars(a.playHead/a.playTime)},a.drawBars=function(t){a.d3config.bars.attr("width",function(e,n){return a.d3config.wInterpolate[n](a.d3config.ease(t))})},a.timeline={bars:{start:0,end:3e3,func:a.drawBars}},a},SVIFT.vis.columnchart=function(t,e){var a=SVIFT.vis.base(t,e);return a.d3config={axisWidth:50,axisHeight:50,ease:d3.easeCubicInOut,yInterpolate:[],hInterpolate:[]},a.setup=function(){a.d3config.x=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t){return t[0]})),a.d3config.xAxis=d3.axisBottom().scale(a.d3config.x),a.d3config.y=d3.scaleLinear().domain([0,d3.max(t.data.data,function(t){return t[1]})]),a.d3config.yAxis=d3.axisLeft().scale(a.d3config.y),a.d3config.gXAxis=a.g.append("g"),a.d3config.gYAxis=a.g.append("g").attr("transform","translate("+a.d3config.axisWidth+",0)"),a.d3config.bars=a.g.append("g").selectAll("rect").data(t.data.data).enter().append("rect").style("stroke","transparent").style("fill","#000")},a.resize=function(){var e=a.container.node().offsetWidth-a.config.margin.left-a.config.margin.right-a.d3config.axisWidth,n=a.container.node().offsetHeight-a.config.margin.top-a.config.margin.bottom-a.d3config.axisHeight;a.d3config.x.range([0,e]),a.d3config.y.range([n,0]),a.d3config.xAxis.scale(a.d3config.x),a.d3config.gXAxis.call(a.d3config.xAxis),a.d3config.yAxis.scale(a.d3config.y),a.d3config.gYAxis.call(a.d3config.yAxis),a.d3config.gXAxis.attr("transform","translate("+a.d3config.axisWidth+","+n+")"),a.d3config.bars.attr("x",function(t){return a.d3config.x(t[0])+a.d3config.axisWidth}).attr("width",a.d3config.x.bandwidth()),t.data.data.forEach(function(t,e){a.d3config.yInterpolate[e]=d3.interpolate(n,a.d3config.y(t[1])),a.d3config.hInterpolate[e]=d3.interpolate(0,n-a.d3config.y(t[1]))}),a.drawBars(a.playHead)},a.drawBars=function(t){a.d3config.bars.attr("y",function(e,n){return a.d3config.yInterpolate[n](a.d3config.ease(t))}).attr("height",function(e,n){return a.d3config.hInterpolate[n](a.d3config.ease(t))})},a.timeline={bars:{start:0,end:3e3,func:a.drawBars}},a},SVIFT.vis.fatnr=function(t,e){var a=SVIFT.vis.base(t,e);return a.d3config={ease:d3.easeCubicInOut,interpolate:d3.interpolate(0,t.data.data[0])},a.setup=function(){a.g.attr("font-family",t.style.font),a.d3config.titleWrapper=a.g.append("g").attr("text-anchor","middle").attr("class","title-wrapper").attr("font-family",t.style.font),a.d3config.titleMain=a.d3config.titleWrapper.append("text").text(t.data.title).attr("fill",t.style.color.main),a.d3config.titleSub=a.d3config.titleWrapper.append("text").text(t.data.subTitle).attr("fill",t.style.color.second),a.d3config.fatNr=a.g.append("text").text(t.data.data[0]).attr("fill",t.style.color.second).attr("text-anchor","middle").attr("font-size",100).attr("opacity",0)},a.resize=function(){var t=a.container.node().offsetWidth-a.config.margin.left-a.config.margin.right,e=a.container.node().offsetHeight-a.config.margin.top-a.config.margin.bottom,n=e-a.d3config.titleWrapper.node().getBBox().height,i=Math.min(n,t);a.d3config.titleMain.attr("font-size","1.7em").attr("x",t/2).attr("y",function(){return a.d3config.titleMainHeight=this.getBBox().height,a.d3config.titleMainHeight}),a.d3config.titleSub.attr("font-size","1em").attr("x",t/2).attr("y",function(){return a.d3config.titleMainHeight+this.getBBox().height}),a.d3config.fatNr.attr("x",t/2).attr("font-size",function(){var t=this.getBBox();console.log(t,this.getBBox());var e=1.1*Math.min(t.width,t.height),n=d3.select(this).attr("font-size");return a.d3config.fatNumberNewSize=n*(i/e),a.d3config.fatNumberNewSize}).attr("opacity",1).attr("y",function(){return a.d3config.titleWrapper.node().getBBox().height+a.d3config.fatNumberNewSize})},a.animateNumber=function(t){var e=Math.round(a.d3config.interpolate(a.d3config.ease(t)));a.d3config.fatNr.text(e)},a.timeline={bars:{start:0,end:3e3,func:a.animateNumber}},a},SVIFT.vis.mosaic=function(t,e){var a=SVIFT.vis.base(t,e);return a.d3config={ease:d3.easeCubicInOut,interpolate:d3.interpolate(0,t.data.data[0])},a.gridSetupData=function(t){var e=.1*t;t-=e;for(var a=Array(),n=1,i=1,r=0;10>r;r++){a.push(Array());for(var o=0;10>o;o++)a[r].push({x:n,y:i,width:t,height:t}),n+=t+e;n=1,i+=t+e}return a},a.setup=function(){a.g.attr("font-family",t.style.font),a.d3config.titleWrapper=a.g.append("g").attr("text-anchor","middle").attr("font-family",t.style.font),a.d3config.titleMain=a.d3config.titleWrapper.append("text").text(t.data.title).attr("fill",t.style.color.main).attr("dominant-baseline","hanging"),a.d3config.titleSub=a.d3config.titleWrapper.append("text").text(t.data.subTitle).attr("fill",t.style.color.second).attr("dominant-baseline","hanging");var e=a.gridSetupData(10);a.d3config.rowContainer=a.g.append("g").attr("id","rowContainer"),a.d3config.row=a.d3config.rowContainer.selectAll(".row").data(e).enter().append("g").attr("class","row"),a.d3config.column=a.d3config.row.selectAll(".square").data(function(t){return t}).enter().append("rect").attr("class","square").style("fill",t.style.color.second).style("stroke","#fff"),a.d3config.valueTextBottom=a.g.append("text").text(t.data.data[0]+"%").attr("font-family",t.style.font).attr("fill",t.style.color.main).attr("text-anchor","middle")},a.resize=function(){var t=a.container.node().offsetWidth-a.config.margin.left-a.config.margin.right,e=a.container.node().offsetHeight-a.config.margin.top-a.config.margin.bottom,n=10;a.d3config.titleMain.attr("x",t/2).attr("font-size","1.7em"),a.d3config.titleSub.attr("x",t/2).attr("y",a.d3config.titleMain.node().getBBox().height).attr("font-size","1em"),a.d3config.valueTextBottom.attr("x",t/2).attr("font-size","3em");var i=a.d3config.titleWrapper.node().getBBox().height+n+(a.d3config.valueTextBottom.node().getBBox().height+n),r=Math.min(t,e-i),o=r/10,d=a.gridSetupData(o);a.d3config.row.data(d).enter(),a.d3config.column.data(function(t){return t}).enter(),a.d3config.column.attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}),a.d3config.rowContainer.attr("transform","translate("+(t-r)/2+","+(a.d3config.titleWrapper.node().getBBox().height+n)+")");var f=a.d3config.rowContainer.node().getBBox().height;a.d3config.valueTextBottom.attr("y",i+f)},a.drawBars=function(e){var n=Math.round(a.d3config.interpolate(a.d3config.ease(e)));d3.selectAll("rect").filter(function(t,e){return n-1>=e}).style("fill",t.style.color.main),a.d3config.valueTextBottom.text(n+"%")},a.timeline={bars:{start:0,end:3e3,func:a.drawBars}},a};