var SVIFT={};SVIFT.helper={},SVIFT.helper.debouncer=function(t,a){var e,n=a||200;return function(){var a=this,i=arguments;clearTimeout(e),e=setTimeout(function(){t.apply(a,Array.prototype.slice.call(i))},n)}},SVIFT.helper.interpolate=function(t){var a,e={};for(e.def=t,e.interpolate=[],e.duration=0,a=1;e.def.length>a;a++)"ease"in e.def[a]||(e.def[a].ease=!1),e.interpolate.push(d3.interpolate(e.def[a-1].value,e.def[a].value)),e.duration+=e.def[a].duration;var n=0;for(a=1;e.def.length>a;a++)e.def[a].duration=e.def[a].duration/e.duration,e.def[a].start=n,n+=e.def[a].duration;return e.i=function(t){for(var a=1;e.def.length>a;a++)if(t>=e.def[a].start&&e.def[a].start+e.def[a].duration>=t)return e.def[a].ease?e.interpolate[a-1](e.def[a].ease((t-e.def[a].start)/e.def[a].duration)):e.interpolate[a-1]((t-e.def[a].start)/e.def[a].duration)},e.i},SVIFT.helper.switchCol=function(t,a,e){return t.forEach(function(t){var n=t[a];t[a]=t[e],t[e]=n}),t},SVIFT.helper.transpose=function(t){var a={};return t.forEach(function(t){for(var e in t)e in a||(a[e]=[])}),t.forEach(function(t){for(var e in a)e in t?a[e].push(t[e]):a[e].push(null)}),a},SVIFT.helper.cleanAxis=function(t){var a;a=t.attr("text-anchor")?t:t.select('g[text-anchor="*"]');var e=a.attr("text-anchor");a.selectAll("text").attr("text-anchor",e);var n=a.attr("font-size");a.selectAll("text").each(function(){var t=d3.select(this);["y","x"].forEach(function(a){var e=t.attr("d"+a);if(e){e.indexOf("em")>=0&&(e=parseFloat(e.substr(0,e.length-2))*n),t.attr("d"+a,0);var i=t.attr(a);i&&(e+=parseFloat(i)),t.attr(a,e)}})})},SVIFT.vis={},SVIFT.vis.base=function(t,a){var e={};return e.data=t,e.container=a,e.g=null,e.svg=null,e.config={maxWidth:4096,maxHeight:4096,margin:{top:20,right:20,bottom:20,left:20}},e.timeline={},e.init=function(){e.svg=e.container.append("svg").attr("width","100%").attr("height","100%").style("background-color","#ffffff"),e.defs=e.svg.append("defs"),e.g=e.svg.append("g").attr("transform","translate("+e.config.margin.top+","+e.config.margin.left+")"),e.playHead=0,e.setup(),e.resize();for(var t in e.timeline){var a=e.timeline[t];a.end>e.playTime&&(e.playTime=a.end)}e.time.step=e.playTime/(e.playTime/1e3*e.time.fps),"function"==typeof window.callPhantom&&window.callPhantom({msg:"setupDone"}),d3.select(window).on("resize",SVIFT.helper.debouncer(function(){e.resize()},200))},e.process=function(){},e.setup=function(){},e.update=function(){},e.resize=function(){},e.draw=function(t){for(var a in e.timeline){var n=e.timeline[a];t>=n.start&&n.end>=t?n.func((t-n.start)/(n.end-n.start)):t>n.end&&n.func(1)}},e.playHead=0,e.playState=!1,e.playTime=0,e.time={fps:30,step:0,elapsed:0,fpsInterval:1e3/30,then:0,startTime:0,now:0},e.play=function(){e.playState&&("function"==typeof window.callPhantom?(e.playHead+=e.time.step,e.playTime>=e.playHead?(e.draw(e.playHead),window.callPhantom({msg:"drawDone",playHead:e.playHead})):(e.playHead=e.playTime,e.draw(e.playHead),e.pause(),window.callPhantom({msg:"playDone"}))):(0===e.time.then&&(e.time.then=e.time.startTime=Date.now()),e.time.now=Date.now(),e.time.elapsed=e.time.now-e.time.then,e.playTime>=e.time.now-e.time.startTime?(window.requestAnimationFrame(e.play),e.time.elapsed>e.time.fpsInterval&&(e.time.then=e.time.now-e.time.elapsed%e.time.fpsInterval,e.playHead=e.time.now-e.time.startTime,e.draw(e.playHead))):(e.playHead=e.playTime,e.goTo(1),e.pause())))},e.start=function(){e.playState=!0,e.play()},e.pause=function(){e.playState=!1},e.goTo=function(t){e.playTime>=t&&(e.playHead=t*e.playTime,e.draw(e.playHead)),e.pause()},e},SVIFT.vis.barchart=function(t,a){var e=SVIFT.vis.base(t,a);return e.d3config={axisWidth:50,axisHeight:50,ease:d3.easeCubicInOut,wInterpolate:[]},e.setup=function(){t.data.data.forEach(function(t,a){var n=e.defs.append("linearGradient").attr("id","grad"+a).attr("x1","0%").attr("y1","0%").attr("y2","0%").attr("x2","100%").attr("spreadMethod","pad");n.append("stop").attr("offset","0%").attr("stop-color","rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")").attr("stop-opacity","1"),n.append("stop").attr("offset","100%").attr("stop-color","rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")").attr("stop-opacity","1")}),e.d3config.y=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t){return t[0]})),e.d3config.yAxis=d3.axisLeft(),e.d3config.x=d3.scaleLinear().domain([0,d3.max(t.data.data,function(t){return t[1]})]),e.d3config.xAxis=d3.axisBottom(),e.d3config.gXAxis=e.g.append("g"),e.d3config.gYAxis=e.g.append("g").attr("transform","translate("+(e.d3config.axisWidth-1)+",0)"),e.d3config.bars=e.g.append("g").selectAll("rect").data(t.data.data).enter().append("rect").attr("x",e.d3config.axisWidth).style("stroke","transparent").style("fill",function(t,a){return'url("#grad'+a+'")'})},e.resize=function(){var a=e.container.node().offsetWidth-e.config.margin.left-e.config.margin.right-e.d3config.axisWidth,n=e.container.node().offsetHeight-e.config.margin.top-e.config.margin.bottom-e.d3config.axisHeight;e.d3config.x.range([0,a]),e.d3config.y.range([0,n]),e.d3config.xAxis.scale(e.d3config.x),e.d3config.gXAxis.call(e.d3config.xAxis),e.d3config.yAxis.scale(e.d3config.y),e.d3config.gYAxis.call(e.d3config.yAxis),e.d3config.gXAxis.attr("transform","translate("+e.d3config.axisWidth+","+n+")"),e.d3config.bars.attr("y",function(t){return e.d3config.y(t[0])}).attr("height",e.d3config.y.bandwidth()),t.data.data.forEach(function(t,a){e.d3config.wInterpolate[a]=d3.interpolate(0,e.d3config.x(t[1]))}),e.drawBars(e.playHead/e.playTime)},e.drawBars=function(t){e.d3config.bars.attr("width",function(a,n){return e.d3config.wInterpolate[n](e.d3config.ease(t))})},e.timeline={bars:{start:0,end:3e3,func:e.drawBars}},e};